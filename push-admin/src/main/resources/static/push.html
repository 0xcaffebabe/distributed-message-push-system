<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>向客户端推送消息</title>
</head>
<body>
    消息内容：
    <input type="text" id="msgInput">
    推送对象：
    <select id="pushTarget">
        <option value="0">全体</option>
        <option value="1">单一用户</option>
    </select>
    用户：
    <input type="text" id="targetUser" disabled>
    <button id="pushButton">推送</button>
</body>
<script src="https://cdn.bootcdn.net/ajax/libs/axios/0.1.0/axios.min.js"></script>
<script>
    let isBroadcast = true
    const pushTargetSelect = document.querySelector("#pushTarget")
    const targetUserInput = document.querySelector("#targetUser")
    const pushButton = document.querySelector("#pushButton")
    const msgInput = document.querySelector("#msgInput")

    pushTargetSelect.addEventListener("change",(e) => {
        onTargetChangeOrClick()
    })
    pushTargetSelect.addEventListener("click",(e) => {
        onTargetChangeOrClick()
    })
    pushButton.addEventListener("click", () => {
        const msg = msgInput.value
        const target = targetUserInput.value
        if (isBroadcast) {
            broadcastMessage(msg)
        } else {
            pushMessageToSomeone(msg, target)
        }
    })
    
    function onTargetChangeOrClick(){
        isBroadcast = pushTargetSelect.value !== "1"
        if (!isBroadcast) {
            targetUserInput.removeAttribute("disabled")
        }else {
            targetUserInput.setAttribute("disabled",!isBroadcast + "")
        }
    }

    function broadcastMessage(msg){
        axios.get(`/message?msg=${msg}`)
            .then(resp => {
                alert(resp)
            })
    }
    function pushMessageToSomeone(msg, target){
        axios.get(`/message?msg=${msg}&target=${target}`)
            .then(resp => {
                alert(resp)
            })
    }

</script>
</html>