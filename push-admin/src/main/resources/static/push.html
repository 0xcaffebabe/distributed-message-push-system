<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <style>
    </style>
    <title>向客户端推送消息</title>
</head>
<body>
    <div class="container form-inline">
        <label for="">消息内容：</label>
        <input type="text" id="msgInput" class="form-control">
        推送对象：
        <select id="pushTarget" class="form-control">
            <option value="0">全体</option>
            <option value="1">单一用户</option>
        </select>
        用户：
        <input type="text" id="targetUser" disabled class="form-control">
        <button id="pushButton">推送</button>
    </div>
</body>
<script src="https://cdn.bootcdn.net/ajax/libs/axios/0.1.0/axios.min.js"></script>
<script>
    let isBroadcast = true
    const pushTargetSelect = document.querySelector("#pushTarget")
    const targetUserInput = document.querySelector("#targetUser")
    const pushButton = document.querySelector("#pushButton")
    const msgInput = document.querySelector("#msgInput")

    pushTargetSelect.addEventListener("change",(e) => {
        onTargetChangeOrClick()
    })
    pushTargetSelect.addEventListener("click",(e) => {
        onTargetChangeOrClick()
    })
    pushButton.addEventListener("click", () => {
        const msg = msgInput.value
        const target = targetUserInput.value
        if (isBroadcast) {
            broadcastMessage(msg)
        } else {
            pushMessageToSomeone(msg, target)
        }
    })
    
    function onTargetChangeOrClick(){
        isBroadcast = pushTargetSelect.value !== "1"
        if (!isBroadcast) {
            targetUserInput.removeAttribute("disabled")
        }else {
            targetUserInput.setAttribute("disabled",!isBroadcast + "")
        }
    }

    function broadcastMessage(msg){
        axios.get(`/api/message?msg=${msg}`)
            .then(resp => {
                alert(resp)
            })
    }
    function pushMessageToSomeone(msg, target){
        axios.get(`/api/message?msg=${msg}&target=${target}`)
            .then(resp => {
                alert(resp)
            })
    }

</script>
</html>